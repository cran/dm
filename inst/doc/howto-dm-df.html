<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2020-05-25" />

<title>Create a dm object from data frames</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Create a dm object from data frames</h1>
<h4 class="date">2020-05-25</h4>



<div id="building-data-models-from-data-frames-with-dm" class="section level1">
<h1>Building data models from data frames with dm</h1>
<p>dm allows you to create your own relational data models from local data frames. Once your data model is complete, you can deploy it a range of DBMSs using dm.</p>
<div id="creating-a-dm-object-from-data-frames" class="section level2">
<h2>Creating a dm object from data frames</h2>
<p>The example data set that we will be using is available through the <a href="https://github.com/hadley/nycflights13"><code>nycflights13</code></a> package. The five tables that we are working with contain information about all flights that departed from the airports of New York to other destinations in the United States in 2013:</p>
<ul>
<li><code>flights</code> represents the trips taken by planes</li>
<li><code>airlines</code> includes
<ul>
<li>the names of transport organizations (<code>name</code>)</li>
<li>their abbreviated codes (<code>carrier</code>)</li>
</ul></li>
<li><code>airports</code> indicates the ports of departure (<code>origin</code>) and of destination (<code>dest</code>)</li>
<li><code>weather</code> contains meteorological information at each hour</li>
<li><code>planes</code> describes characteristics of the aircraft</li>
</ul>
<p>Once we’ve loaded {nycflights13}, the aforementioned tables are all in our work environment, ready to be accessed.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(nycflights13)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a>airports</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #555555;"># A tibble: 1,458 x 8</span><span>
#&gt;    faa   name                    lat    lon   alt    tz dst   tzone        
#&gt;    </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>                 </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>        
#&gt; </span><span style="color: #555555;"> 1</span><span> 04G   Lansdowne Airport      41.1  -</span><span style="color: #BB0000;">80.6</span><span>  </span><span style="text-decoration: underline;">1</span><span>044    -</span><span style="color: #BB0000;">5</span><span> A     America/New_…
#&gt; </span><span style="color: #555555;"> 2</span><span> 06A   Moton Field Municipa…  32.5  -</span><span style="color: #BB0000;">85.7</span><span>   264    -</span><span style="color: #BB0000;">6</span><span> A     America/Chic…
#&gt; </span><span style="color: #555555;"> 3</span><span> 06C   Schaumburg Regional    42.0  -</span><span style="color: #BB0000;">88.1</span><span>   801    -</span><span style="color: #BB0000;">6</span><span> A     America/Chic…
#&gt; </span><span style="color: #555555;"> 4</span><span> 06N   Randall Airport        41.4  -</span><span style="color: #BB0000;">74.4</span><span>   523    -</span><span style="color: #BB0000;">5</span><span> A     America/New_…
#&gt; </span><span style="color: #555555;"> 5</span><span> 09J   Jekyll Island Airport  31.1  -</span><span style="color: #BB0000;">81.4</span><span>    11    -</span><span style="color: #BB0000;">5</span><span> A     America/New_…
#&gt; </span><span style="color: #555555;"> 6</span><span> 0A9   Elizabethton Municip…  36.4  -</span><span style="color: #BB0000;">82.2</span><span>  </span><span style="text-decoration: underline;">1</span><span>593    -</span><span style="color: #BB0000;">5</span><span> A     America/New_…
#&gt; </span><span style="color: #555555;"> 7</span><span> 0G6   Williams County Airp…  41.5  -</span><span style="color: #BB0000;">84.5</span><span>   730    -</span><span style="color: #BB0000;">5</span><span> A     America/New_…
#&gt; </span><span style="color: #555555;"> 8</span><span> 0G7   Finger Lakes Regiona…  42.9  -</span><span style="color: #BB0000;">76.8</span><span>   492    -</span><span style="color: #BB0000;">5</span><span> A     America/New_…
#&gt; </span><span style="color: #555555;"> 9</span><span> 0P2   Shoestring Aviation …  39.8  -</span><span style="color: #BB0000;">76.6</span><span>  </span><span style="text-decoration: underline;">1</span><span>000    -</span><span style="color: #BB0000;">5</span><span> U     America/New_…
#&gt; </span><span style="color: #555555;">10</span><span> 0S9   Jefferson County Intl  48.1 -</span><span style="color: #BB0000;">123.</span><span>    108    -</span><span style="color: #BB0000;">8</span><span> A     America/Los_…
#&gt; </span><span style="color: #555555;"># … with 1,448 more rows</span><span>
</span></CODE></PRE>
<p>Your own data will probably not be available as an R package. Whatever format it is in, you will need to be able to load it as data frames into your R session. If the data is too large, consider using dm to connect to the database instead. See <code>vignette(&quot;howto-dm-db&quot;)</code> for details on using dm with databases.</p>
</div>
<div id="adding-tables" class="section level2">
<h2>Adding Tables</h2>
<p>Our first step will be to tell <code>dm</code> which tables we want to work with and how they are connected. For that we can use <code>dm()</code>, passing in the table names as arguments.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">library</span>(dm)</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a>flights_dm_no_keys &lt;-<span class="st"> </span><span class="kw">dm</span>(airlines, airports, flights, planes, weather)</span>
<span id="cb2-4"><a href="#cb2-4"></a>flights_dm_no_keys</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #00BB00;">──</span><span> </span><span style="color: #00BB00;">Table source</span><span> </span><span style="color: #00BB00;">───────────────────────────────────────────────────────────</span><span>
#&gt; src:  &lt;environment: R_GlobalEnv&gt;
#&gt; </span><span style="color: #555555;">──</span><span> </span><span style="color: #555555;">Metadata</span><span> </span><span style="color: #555555;">───────────────────────────────────────────────────────────────</span><span>
#&gt; Tables: `airlines`, `airports`, `flights`, `planes`, `weather`
#&gt; Columns: 53
#&gt; Primary keys: 0
#&gt; Foreign keys: 0
</span></CODE></PRE>
<p>The <code>as_dm()</code> function is an alternative that works if you already have a list of tables.</p>
</div>
<div id="defining-keys" class="section level2">
<h2>Defining Keys</h2>
<p>Even though we now have a <code>dm</code> object that contains all our data, we have not specified how our five tables are connected (the foreign keys), and which column(s) uniquely identify the observations within the tables (the primary keys).</p>
</div>
<div id="primary-keys" class="section level2">
<h2>Primary Keys</h2>
<p><code>dm</code> offers <code>dm_enum_pk_candidates()</code> to identify viable primary keys, and <code>dm_add_pk()</code> to add them.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">dm_enum_pk_candidates</span>(</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="dt">dm =</span> flights_dm_no_keys,</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="dt">table =</span> planes</span>
<span id="cb3-4"><a href="#cb3-4"></a>)</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #555555;"># A tibble: 9 x 3</span><span>
#&gt;   columns     candidate why                                                
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;keys&gt;</span><span>      </span><span style="color: #555555;font-style: italic;">&lt;lgl&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>                                              
#&gt; </span><span style="color: #555555;">1</span><span> tailnum     TRUE      </span><span style="color: #555555;">&quot;&quot;</span><span>                                                 
#&gt; </span><span style="color: #555555;">2</span><span> engine      FALSE     </span><span style="color: #555555;">&quot;</span><span>has duplicate values: 4 Cycle, Reciprocating, Tur…
#&gt; </span><span style="color: #555555;">3</span><span> engines     FALSE     </span><span style="color: #555555;">&quot;</span><span>has duplicate values: 1, 2, 3, 4</span><span style="color: #555555;">&quot;</span><span>                 
#&gt; </span><span style="color: #555555;">4</span><span> manufactur… FALSE     </span><span style="color: #555555;">&quot;</span><span>has duplicate values: AIRBUS, AIRBUS INDUSTRIE, A…
#&gt; </span><span style="color: #555555;">5</span><span> model       FALSE     </span><span style="color: #555555;">&quot;</span><span>has duplicate values: 717-200, 737-301, 737-3G7, …
#&gt; </span><span style="color: #555555;">6</span><span> seats       FALSE     </span><span style="color: #555555;">&quot;</span><span>has duplicate values: 2, 4, 5, 6, 7, …</span><span style="color: #555555;">&quot;</span><span>           
#&gt; </span><span style="color: #555555;">7</span><span> speed       FALSE     </span><span style="color: #555555;">&quot;</span><span>has duplicate values: 90, 105, 162, 432, NA</span><span style="color: #555555;">&quot;</span><span>      
#&gt; </span><span style="color: #555555;">8</span><span> type        FALSE     </span><span style="color: #555555;">&quot;</span><span>has duplicate values: Fixed wing multi engine, Fi…
#&gt; </span><span style="color: #555555;">9</span><span> year        FALSE     </span><span style="color: #555555;">&quot;</span><span>has duplicate values: 1959, 1963, 1975, 1976, 197…
</span></CODE></PRE>
<p>Now, we add the primary keys that we have identified:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>flights_dm_only_pks &lt;-</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="st">  </span>flights_dm_no_keys <span class="op">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="st">  </span><span class="kw">dm_add_pk</span>(<span class="dt">table =</span> airlines, <span class="dt">columns =</span> carrier) <span class="op">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="st">  </span><span class="kw">dm_add_pk</span>(airports, faa) <span class="op">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="st">  </span><span class="kw">dm_add_pk</span>(planes, tailnum)</span>
<span id="cb4-6"><a href="#cb4-6"></a>flights_dm_only_pks</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #00BB00;">──</span><span> </span><span style="color: #00BB00;">Table source</span><span> </span><span style="color: #00BB00;">───────────────────────────────────────────────────────────</span><span>
#&gt; src:  &lt;environment: R_GlobalEnv&gt;
#&gt; </span><span style="color: #555555;">──</span><span> </span><span style="color: #555555;">Metadata</span><span> </span><span style="color: #555555;">───────────────────────────────────────────────────────────────</span><span>
#&gt; Tables: `airlines`, `airports`, `flights`, `planes`, `weather`
#&gt; Columns: 53
#&gt; Primary keys: 3
#&gt; Foreign keys: 0
</span></CODE></PRE>
<p>Note that we demonstrate both named and positional arguments above.</p>
</div>
<div id="foreign-keys" class="section level2">
<h2>Foreign Keys</h2>
<p>To define how our tables are related, we use <code>dm_add_fk()</code> to add foreign keys. In calling <code>dm_add_fk()</code> the <code>table</code> argument is the table that needs a foreign key to link it to a second table. <code>ref_table</code> is the table to be linked to and it needs a primary key already defined for it.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">dm_enum_fk_candidates</span>(</span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="dt">dm =</span> flights_dm_only_pks,</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="dt">table =</span> flights,</span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="dt">ref_table =</span> airlines</span>
<span id="cb5-5"><a href="#cb5-5"></a>)</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #555555;"># A tibble: 19 x 3</span><span>
#&gt;    columns      candidate why                                              
#&gt;    </span><span style="color: #555555;font-style: italic;">&lt;keys&gt;</span><span>       </span><span style="color: #555555;font-style: italic;">&lt;lgl&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>                                            
#&gt; </span><span style="color: #555555;"> 1</span><span> carrier      TRUE      </span><span style="color: #555555;">&quot;&quot;</span><span>                                               
#&gt; </span><span style="color: #555555;"> 2</span><span> tailnum      FALSE     </span><span style="color: #555555;">&quot;</span><span>334264 entries (99.3%) of `flights$tailnum` not…
#&gt; </span><span style="color: #555555;"> 3</span><span> dest         FALSE     </span><span style="color: #555555;">&quot;</span><span>336776 entries (100%) of `flights$dest` not in …
#&gt; </span><span style="color: #555555;"> 4</span><span> origin       FALSE     </span><span style="color: #555555;">&quot;</span><span>336776 entries (100%) of `flights$origin` not i…
#&gt; </span><span style="color: #555555;"> 5</span><span> air_time     FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;"> 6</span><span> arr_delay    FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;"> 7</span><span> arr_time     FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;"> 8</span><span> day          FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;"> 9</span><span> dep_delay    FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;">10</span><span> dep_time     FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;">11</span><span> distance     FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;">12</span><span> flight       FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;">13</span><span> hour         FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;">14</span><span> minute       FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;">15</span><span> month        FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;">16</span><span> sched_arr_t… FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;">17</span><span> sched_dep_t… FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;">18</span><span> time_hour    FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
#&gt; </span><span style="color: #555555;">19</span><span> year         FALSE     </span><span style="color: #555555;">&quot;</span><span>Can&#39;t join on `x$value` x `y$value` because of …
</span></CODE></PRE>
<p>Having chosen a column from the successful candidates provided by <code>dm_enum_fk_candidates()</code>, we use the <code>dm_add_fk()</code> function to establish the foreign key linking the tables. In the second call to <code>dm_add_fk()</code> we complete the process for the <code>flights</code> and <code>airlines</code> tables that we started above. The <code>carrier</code> column in the <code>airlines</code> table will be added as the foreign key in <code>flights</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>flights_dm_all_keys &lt;-</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="st">  </span>flights_dm_only_pks <span class="op">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="st">  </span><span class="kw">dm_add_fk</span>(<span class="dt">table =</span> flights, <span class="dt">columns =</span> tailnum, <span class="dt">ref_table =</span> planes) <span class="op">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="st">  </span><span class="kw">dm_add_fk</span>(flights, carrier, airlines) <span class="op">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="st">  </span><span class="kw">dm_add_fk</span>(flights, origin, airports)</span>
<span id="cb6-6"><a href="#cb6-6"></a>flights_dm_all_keys</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #00BB00;">──</span><span> </span><span style="color: #00BB00;">Table source</span><span> </span><span style="color: #00BB00;">───────────────────────────────────────────────────────────</span><span>
#&gt; src:  &lt;environment: R_GlobalEnv&gt;
#&gt; </span><span style="color: #555555;">──</span><span> </span><span style="color: #555555;">Metadata</span><span> </span><span style="color: #555555;">───────────────────────────────────────────────────────────────</span><span>
#&gt; Tables: `airlines`, `airports`, `flights`, `planes`, `weather`
#&gt; Columns: 53
#&gt; Primary keys: 3
#&gt; Foreign keys: 3
</span></CODE></PRE>
<p>Having created the required primary and foreign keys to link all the tables together, we now have a relational data model we can work with.</p>
</div>
<div id="visualization" class="section level2">
<h2>Visualization</h2>
<p>Visualizing a data model is a quick and easy way to verify that we have successfully created the model we were aiming for. We can use <code>dm_draw()</code> at any stage of the process to generate a visual representation of the tables and the links between them:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>flights_dm_no_keys <span class="op">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">  </span><span class="kw">dm_draw</span>(<span class="dt">rankdir =</span> <span class="st">&quot;TB&quot;</span>, <span class="dt">view_type =</span> <span class="st">&quot;all&quot;</span>)</span></code></pre></div>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %0 Pages: 1 -->
<svg width="436pt" height="410pt" viewBox="0.00 0.00 436.00 410.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 406)">
<title>%0</title>
<g id="a_graph0"><a xlink:title="Data Model">
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-406 432,-406 432,4 -4,4"></polygon>
</a>
</g>
<!-- airlines -->
<g id="node1" class="node">
<title>airlines</title>
<polygon fill="#efebdd" stroke="transparent" points="5,-211 5,-231 50,-231 50,-211 5,-211"></polygon>
<text text-anchor="start" x="6.8969" y="-216.4" font-family="Times,serif" font-size="14.00" fill="#000000">airlines</text>
<polygon fill="#ffffff" stroke="transparent" points="5,-191 5,-211 50,-211 50,-191 5,-191"></polygon>
<text text-anchor="start" x="7" y="-196.4" font-family="Times,serif" font-size="14.00" fill="#444444">carrier</text>
<polygon fill="#ffffff" stroke="transparent" points="5,-171 5,-191 50,-191 50,-171 5,-171"></polygon>
<text text-anchor="start" x="7" y="-176.4" font-family="Times,serif" font-size="14.00" fill="#444444">name</text>
<polygon fill="none" stroke="#555555" points="3.5,-170 3.5,-232 50.5,-232 50.5,-170 3.5,-170"></polygon>
</g>
<!-- airports -->
<g id="node2" class="node">
<title>airports</title>
<polygon fill="#efebdd" stroke="transparent" points="76,-271 76,-291 122,-291 122,-271 76,-271"></polygon>
<text text-anchor="start" x="77.6192" y="-276.4" font-family="Times,serif" font-size="14.00" fill="#000000">airports</text>
<polygon fill="#ffffff" stroke="transparent" points="76,-251 76,-271 122,-271 122,-251 76,-251"></polygon>
<text text-anchor="start" x="78" y="-256.4" font-family="Times,serif" font-size="14.00" fill="#444444">faa</text>
<polygon fill="#ffffff" stroke="transparent" points="76,-231 76,-251 122,-251 122,-231 76,-231"></polygon>
<text text-anchor="start" x="78" y="-236.4" font-family="Times,serif" font-size="14.00" fill="#444444">name</text>
<polygon fill="#ffffff" stroke="transparent" points="76,-211 76,-231 122,-231 122,-211 76,-211"></polygon>
<text text-anchor="start" x="78" y="-216.4" font-family="Times,serif" font-size="14.00" fill="#444444">lat</text>
<polygon fill="#ffffff" stroke="transparent" points="76,-191 76,-211 122,-211 122,-191 76,-191"></polygon>
<text text-anchor="start" x="78" y="-196.4" font-family="Times,serif" font-size="14.00" fill="#444444">lon</text>
<polygon fill="#ffffff" stroke="transparent" points="76,-171 76,-191 122,-191 122,-171 76,-171"></polygon>
<text text-anchor="start" x="78" y="-176.4" font-family="Times,serif" font-size="14.00" fill="#444444">alt</text>
<polygon fill="#ffffff" stroke="transparent" points="76,-151 76,-171 122,-171 122,-151 76,-151"></polygon>
<text text-anchor="start" x="78" y="-156.4" font-family="Times,serif" font-size="14.00" fill="#444444">tz</text>
<polygon fill="#ffffff" stroke="transparent" points="76,-131 76,-151 122,-151 122,-131 76,-131"></polygon>
<text text-anchor="start" x="78" y="-136.4" font-family="Times,serif" font-size="14.00" fill="#444444">dst</text>
<polygon fill="#ffffff" stroke="transparent" points="76,-111 76,-131 122,-131 122,-111 76,-111"></polygon>
<text text-anchor="start" x="78" y="-116.4" font-family="Times,serif" font-size="14.00" fill="#444444">tzone</text>
<polygon fill="none" stroke="#555555" points="75,-110 75,-292 123,-292 123,-110 75,-110"></polygon>
</g>
<!-- flights -->
<g id="node3" class="node">
<title>flights</title>
<polygon fill="#efebdd" stroke="transparent" points="145,-381 145,-401 239,-401 239,-381 145,-381"></polygon>
<text text-anchor="start" x="174.1115" y="-386.4" font-family="Times,serif" font-size="14.00" fill="#000000">flights</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-361 145,-381 239,-381 239,-361 145,-361"></polygon>
<text text-anchor="start" x="147" y="-366.4" font-family="Times,serif" font-size="14.00" fill="#444444">year</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-341 145,-361 239,-361 239,-341 145,-341"></polygon>
<text text-anchor="start" x="147" y="-346.4" font-family="Times,serif" font-size="14.00" fill="#444444">month</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-321 145,-341 239,-341 239,-321 145,-321"></polygon>
<text text-anchor="start" x="147" y="-326.4" font-family="Times,serif" font-size="14.00" fill="#444444">day</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-301 145,-321 239,-321 239,-301 145,-301"></polygon>
<text text-anchor="start" x="147" y="-306.4" font-family="Times,serif" font-size="14.00" fill="#444444">dep_time</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-281 145,-301 239,-301 239,-281 145,-281"></polygon>
<text text-anchor="start" x="146.5126" y="-286.4" font-family="Times,serif" font-size="14.00" fill="#444444">sched_dep_time</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-261 145,-281 239,-281 239,-261 145,-261"></polygon>
<text text-anchor="start" x="147" y="-266.4" font-family="Times,serif" font-size="14.00" fill="#444444">dep_delay</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-241 145,-261 239,-261 239,-241 145,-241"></polygon>
<text text-anchor="start" x="147" y="-246.4" font-family="Times,serif" font-size="14.00" fill="#444444">arr_time</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-221 145,-241 239,-241 239,-221 145,-221"></polygon>
<text text-anchor="start" x="147" y="-226.4" font-family="Times,serif" font-size="14.00" fill="#444444">sched_arr_time</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-201 145,-221 239,-221 239,-201 145,-201"></polygon>
<text text-anchor="start" x="147" y="-206.4" font-family="Times,serif" font-size="14.00" fill="#444444">arr_delay</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-181 145,-201 239,-201 239,-181 145,-181"></polygon>
<text text-anchor="start" x="147" y="-186.4" font-family="Times,serif" font-size="14.00" fill="#444444">carrier</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-161 145,-181 239,-181 239,-161 145,-161"></polygon>
<text text-anchor="start" x="147" y="-166.4" font-family="Times,serif" font-size="14.00" fill="#444444">flight</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-141 145,-161 239,-161 239,-141 145,-141"></polygon>
<text text-anchor="start" x="147" y="-146.4" font-family="Times,serif" font-size="14.00" fill="#444444">tailnum</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-121 145,-141 239,-141 239,-121 145,-121"></polygon>
<text text-anchor="start" x="147" y="-126.4" font-family="Times,serif" font-size="14.00" fill="#444444">origin</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-101 145,-121 239,-121 239,-101 145,-101"></polygon>
<text text-anchor="start" x="147" y="-106.4" font-family="Times,serif" font-size="14.00" fill="#444444">dest</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-81 145,-101 239,-101 239,-81 145,-81"></polygon>
<text text-anchor="start" x="147" y="-86.4" font-family="Times,serif" font-size="14.00" fill="#444444">air_time</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-61 145,-81 239,-81 239,-61 145,-61"></polygon>
<text text-anchor="start" x="147" y="-66.4" font-family="Times,serif" font-size="14.00" fill="#444444">distance</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-41 145,-61 239,-61 239,-41 145,-41"></polygon>
<text text-anchor="start" x="147" y="-46.4" font-family="Times,serif" font-size="14.00" fill="#444444">hour</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-21 145,-41 239,-41 239,-21 145,-21"></polygon>
<text text-anchor="start" x="147" y="-26.4" font-family="Times,serif" font-size="14.00" fill="#444444">minute</text>
<polygon fill="#ffffff" stroke="transparent" points="145,-1 145,-21 239,-21 239,-1 145,-1"></polygon>
<text text-anchor="start" x="147" y="-6.4" font-family="Times,serif" font-size="14.00" fill="#444444">time_hour</text>
<polygon fill="none" stroke="#555555" points="144,0 144,-402 240,-402 240,0 144,0"></polygon>
</g>
<!-- planes -->
<g id="node4" class="node">
<title>planes</title>
<polygon fill="#efebdd" stroke="transparent" points="259,-281 259,-301 337,-301 337,-281 259,-281"></polygon>
<text text-anchor="start" x="280.1178" y="-286.4" font-family="Times,serif" font-size="14.00" fill="#000000">planes</text>
<polygon fill="#ffffff" stroke="transparent" points="259,-261 259,-281 337,-281 337,-261 259,-261"></polygon>
<text text-anchor="start" x="261" y="-266.4" font-family="Times,serif" font-size="14.00" fill="#444444">tailnum</text>
<polygon fill="#ffffff" stroke="transparent" points="259,-241 259,-261 337,-261 337,-241 259,-241"></polygon>
<text text-anchor="start" x="261" y="-246.4" font-family="Times,serif" font-size="14.00" fill="#444444">year</text>
<polygon fill="#ffffff" stroke="transparent" points="259,-221 259,-241 337,-241 337,-221 259,-221"></polygon>
<text text-anchor="start" x="261" y="-226.4" font-family="Times,serif" font-size="14.00" fill="#444444">type</text>
<polygon fill="#ffffff" stroke="transparent" points="259,-201 259,-221 337,-221 337,-201 259,-201"></polygon>
<text text-anchor="start" x="260.6893" y="-206.4" font-family="Times,serif" font-size="14.00" fill="#444444">manufacturer</text>
<polygon fill="#ffffff" stroke="transparent" points="259,-181 259,-201 337,-201 337,-181 259,-181"></polygon>
<text text-anchor="start" x="261" y="-186.4" font-family="Times,serif" font-size="14.00" fill="#444444">model</text>
<polygon fill="#ffffff" stroke="transparent" points="259,-161 259,-181 337,-181 337,-161 259,-161"></polygon>
<text text-anchor="start" x="261" y="-166.4" font-family="Times,serif" font-size="14.00" fill="#444444">engines</text>
<polygon fill="#ffffff" stroke="transparent" points="259,-141 259,-161 337,-161 337,-141 259,-141"></polygon>
<text text-anchor="start" x="261" y="-146.4" font-family="Times,serif" font-size="14.00" fill="#444444">seats</text>
<polygon fill="#ffffff" stroke="transparent" points="259,-121 259,-141 337,-141 337,-121 259,-121"></polygon>
<text text-anchor="start" x="261" y="-126.4" font-family="Times,serif" font-size="14.00" fill="#444444">speed</text>
<polygon fill="#ffffff" stroke="transparent" points="259,-101 259,-121 337,-121 337,-101 259,-101"></polygon>
<text text-anchor="start" x="261" y="-106.4" font-family="Times,serif" font-size="14.00" fill="#444444">engine</text>
<polygon fill="none" stroke="#555555" points="258,-100 258,-302 338,-302 338,-100 258,-100"></polygon>
</g>
<!-- weather -->
<g id="node5" class="node">
<title>weather</title>
<polygon fill="#efebdd" stroke="transparent" points="357,-341 357,-361 427,-361 427,-341 357,-341"></polygon>
<text text-anchor="start" x="369.8492" y="-346.4" font-family="Times,serif" font-size="14.00" fill="#000000">weather</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-321 357,-341 427,-341 427,-321 357,-321"></polygon>
<text text-anchor="start" x="359" y="-326.4" font-family="Times,serif" font-size="14.00" fill="#444444">origin</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-301 357,-321 427,-321 427,-301 357,-301"></polygon>
<text text-anchor="start" x="359" y="-306.4" font-family="Times,serif" font-size="14.00" fill="#444444">year</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-281 357,-301 427,-301 427,-281 357,-281"></polygon>
<text text-anchor="start" x="359" y="-286.4" font-family="Times,serif" font-size="14.00" fill="#444444">month</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-261 357,-281 427,-281 427,-261 357,-261"></polygon>
<text text-anchor="start" x="359" y="-266.4" font-family="Times,serif" font-size="14.00" fill="#444444">day</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-241 357,-261 427,-261 427,-241 357,-241"></polygon>
<text text-anchor="start" x="359" y="-246.4" font-family="Times,serif" font-size="14.00" fill="#444444">hour</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-221 357,-241 427,-241 427,-221 357,-221"></polygon>
<text text-anchor="start" x="359" y="-226.4" font-family="Times,serif" font-size="14.00" fill="#444444">temp</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-201 357,-221 427,-221 427,-201 357,-201"></polygon>
<text text-anchor="start" x="359" y="-206.4" font-family="Times,serif" font-size="14.00" fill="#444444">dewp</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-181 357,-201 427,-201 427,-181 357,-181"></polygon>
<text text-anchor="start" x="359" y="-186.4" font-family="Times,serif" font-size="14.00" fill="#444444">humid</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-161 357,-181 427,-181 427,-161 357,-161"></polygon>
<text text-anchor="start" x="359" y="-166.4" font-family="Times,serif" font-size="14.00" fill="#444444">wind_dir</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-141 357,-161 427,-161 427,-141 357,-141"></polygon>
<text text-anchor="start" x="358.5645" y="-146.4" font-family="Times,serif" font-size="14.00" fill="#444444">wind_speed</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-121 357,-141 427,-141 427,-121 357,-121"></polygon>
<text text-anchor="start" x="359" y="-126.4" font-family="Times,serif" font-size="14.00" fill="#444444">wind_gust</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-101 357,-121 427,-121 427,-101 357,-101"></polygon>
<text text-anchor="start" x="359" y="-106.4" font-family="Times,serif" font-size="14.00" fill="#444444">precip</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-81 357,-101 427,-101 427,-81 357,-81"></polygon>
<text text-anchor="start" x="359" y="-86.4" font-family="Times,serif" font-size="14.00" fill="#444444">pressure</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-61 357,-81 427,-81 427,-61 357,-61"></polygon>
<text text-anchor="start" x="359" y="-66.4" font-family="Times,serif" font-size="14.00" fill="#444444">visib</text>
<polygon fill="#ffffff" stroke="transparent" points="357,-41 357,-61 427,-61 427,-41 357,-41"></polygon>
<text text-anchor="start" x="359" y="-46.4" font-family="Times,serif" font-size="14.00" fill="#444444">time_hour</text>
<polygon fill="none" stroke="#555555" points="356,-40 356,-362 428,-362 428,-40 356,-40"></polygon>
</g>
</g>
</svg>

<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a></span>
<span id="cb8-2"><a href="#cb8-2"></a>flights_dm_no_keys <span class="op">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="st">  </span><span class="kw">dm_add_pk</span>(airlines, carrier) <span class="op">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="st">  </span><span class="kw">dm_draw</span>()</span></code></pre></div>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %0 Pages: 1 -->
<svg width="62pt" height="266pt" viewBox="0.00 0.00 62.00 266.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 262)">
<title>%0</title>
<g id="a_graph0"><a xlink:title="Data Model">
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-262 58,-262 58,4 -4,4"></polygon>
</a>
</g>
<!-- airlines -->
<g id="node1" class="node">
<title>airlines</title>
<polygon fill="#efebdd" stroke="transparent" points="5,-21 5,-41 50,-41 50,-21 5,-21"></polygon>
<text text-anchor="start" x="6.8969" y="-26.4" font-family="Times,serif" font-size="14.00" fill="#000000">airlines</text>
<polygon fill="#ffffff" stroke="transparent" points="5,-1 5,-21 50,-21 50,-1 5,-1"></polygon>
<text text-anchor="start" x="7" y="-7.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">carrier</text>
<polygon fill="none" stroke="#555555" points="3.5,0 3.5,-42 50.5,-42 50.5,0 3.5,0"></polygon>
</g>
<!-- airports -->
<g id="node2" class="node">
<title>airports</title>
<polygon fill="#efebdd" stroke="transparent" points="4,-68 4,-88 50,-88 50,-68 4,-68"></polygon>
<text text-anchor="start" x="5.6192" y="-73.4" font-family="Times,serif" font-size="14.00" fill="#000000">airports</text>
<polygon fill="none" stroke="#555555" points="3,-67 3,-89 51,-89 51,-67 3,-67"></polygon>
</g>
<!-- flights -->
<g id="node3" class="node">
<title>flights</title>
<polygon fill="#efebdd" stroke="transparent" points="8,-122 8,-142 47,-142 47,-122 8,-122"></polygon>
<text text-anchor="start" x="9.6115" y="-127.4" font-family="Times,serif" font-size="14.00" fill="#000000">flights</text>
<polygon fill="none" stroke="#555555" points="6.5,-121 6.5,-143 47.5,-143 47.5,-121 6.5,-121"></polygon>
</g>
<!-- planes -->
<g id="node4" class="node">
<title>planes</title>
<polygon fill="#efebdd" stroke="transparent" points="8,-176 8,-196 47,-196 47,-176 8,-176"></polygon>
<text text-anchor="start" x="9.6178" y="-181.4" font-family="Times,serif" font-size="14.00" fill="#000000">planes</text>
<polygon fill="none" stroke="#555555" points="6.5,-175 6.5,-197 47.5,-197 47.5,-175 6.5,-175"></polygon>
</g>
<!-- weather -->
<g id="node5" class="node">
<title>weather</title>
<polygon fill="#efebdd" stroke="transparent" points="3,-230 3,-250 51,-250 51,-230 3,-230"></polygon>
<text text-anchor="start" x="4.8492" y="-235.4" font-family="Times,serif" font-size="14.00" fill="#000000">weather</text>
<polygon fill="none" stroke="#555555" points="2,-229 2,-251 52,-251 52,-229 2,-229"></polygon>
</g>
</g>
</svg>

<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a></span>
<span id="cb9-2"><a href="#cb9-2"></a>flights_dm_only_pks <span class="op">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="st">  </span><span class="kw">dm_add_fk</span>(flights, tailnum, planes) <span class="op">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="st">  </span><span class="kw">dm_draw</span>()</span></code></pre></div>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %0 Pages: 1 -->
<svg width="152pt" height="224pt" viewBox="0.00 0.00 152.00 224.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 220)">
<title>%0</title>
<g id="a_graph0"><a xlink:title="Data Model">
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-220 148,-220 148,4 -4,4"></polygon>
</a>
</g>
<!-- airlines -->
<g id="node1" class="node">
<title>airlines</title>
<polygon fill="#efebdd" stroke="transparent" points="5,-21 5,-41 50,-41 50,-21 5,-21"></polygon>
<text text-anchor="start" x="6.8969" y="-26.4" font-family="Times,serif" font-size="14.00" fill="#000000">airlines</text>
<polygon fill="#ffffff" stroke="transparent" points="5,-1 5,-21 50,-21 50,-1 5,-1"></polygon>
<text text-anchor="start" x="7" y="-7.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">carrier</text>
<polygon fill="none" stroke="#555555" points="3.5,0 3.5,-42 50.5,-42 50.5,0 3.5,0"></polygon>
</g>
<!-- airports -->
<g id="node2" class="node">
<title>airports</title>
<polygon fill="#efebdd" stroke="transparent" points="4,-81 4,-101 50,-101 50,-81 4,-81"></polygon>
<text text-anchor="start" x="5.6192" y="-86.4" font-family="Times,serif" font-size="14.00" fill="#000000">airports</text>
<polygon fill="#ffffff" stroke="transparent" points="4,-61 4,-81 50,-81 50,-61 4,-61"></polygon>
<text text-anchor="start" x="6" y="-67.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">faa</text>
<polygon fill="none" stroke="#555555" points="3,-60 3,-102 51,-102 51,-60 3,-60"></polygon>
</g>
<!-- flights -->
<g id="node3" class="node">
<title>flights</title>
<polygon fill="#efebdd" stroke="transparent" points="4,-141 4,-161 50,-161 50,-141 4,-141"></polygon>
<text text-anchor="start" x="9.1115" y="-146.4" font-family="Times,serif" font-size="14.00" fill="#000000">flights</text>
<polygon fill="#ffffff" stroke="transparent" points="4,-121 4,-141 50,-141 50,-121 4,-121"></polygon>
<text text-anchor="start" x="5.6115" y="-126.4" font-family="Times,serif" font-size="14.00" fill="#444444">tailnum</text>
<polygon fill="none" stroke="#555555" points="3,-120 3,-162 51,-162 51,-120 3,-120"></polygon>
</g>
<!-- planes -->
<g id="node4" class="node">
<title>planes</title>
<polygon fill="#efebdd" stroke="transparent" points="94,-141 94,-161 140,-161 140,-141 94,-141"></polygon>
<text text-anchor="start" x="99.1178" y="-146.4" font-family="Times,serif" font-size="14.00" fill="#000000">planes</text>
<polygon fill="#ffffff" stroke="transparent" points="94,-121 94,-141 140,-141 140,-121 94,-121"></polygon>
<text text-anchor="start" x="95.6115" y="-127.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">tailnum</text>
<polygon fill="none" stroke="#555555" points="93,-120 93,-162 141,-162 141,-120 93,-120"></polygon>
</g>
<!-- flights&#45;&gt;planes -->
<g id="edge1" class="edge">
<title>flights:tailnum-&gt;planes:tailnum</title>
<path fill="none" stroke="#555555" d="M50,-131C65.5833,-131 71.8532,-131 83.6529,-131"></path>
<polygon fill="#555555" stroke="#555555" points="84,-134.5001 94,-131 84,-127.5001 84,-134.5001"></polygon>
</g>
<!-- weather -->
<g id="node5" class="node">
<title>weather</title>
<polygon fill="#efebdd" stroke="transparent" points="3,-188 3,-208 51,-208 51,-188 3,-188"></polygon>
<text text-anchor="start" x="4.8492" y="-193.4" font-family="Times,serif" font-size="14.00" fill="#000000">weather</text>
<polygon fill="none" stroke="#555555" points="2,-187 2,-209 52,-209 52,-187 2,-187"></polygon>
</g>
</g>
</svg>

<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a></span>
<span id="cb10-2"><a href="#cb10-2"></a>flights_dm_all_keys <span class="op">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="st">  </span><span class="kw">dm_draw</span>()</span></code></pre></div>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %0 Pages: 1 -->
<svg width="152pt" height="184pt" viewBox="0.00 0.00 152.00 184.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 180)">
<title>%0</title>
<g id="a_graph0"><a xlink:title="Data Model">
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-180 148,-180 148,4 -4,4"></polygon>
</a>
</g>
<!-- airlines -->
<g id="node1" class="node">
<title>airlines</title>
<polygon fill="#efebdd" stroke="transparent" points="95,-141 95,-161 140,-161 140,-141 95,-141"></polygon>
<text text-anchor="start" x="96.8969" y="-146.4" font-family="Times,serif" font-size="14.00" fill="#000000">airlines</text>
<polygon fill="#ffffff" stroke="transparent" points="95,-121 95,-141 140,-141 140,-121 95,-121"></polygon>
<text text-anchor="start" x="97" y="-127.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">carrier</text>
<polygon fill="none" stroke="#555555" points="93.5,-120 93.5,-162 140.5,-162 140.5,-120 93.5,-120"></polygon>
</g>
<!-- airports -->
<g id="node2" class="node">
<title>airports</title>
<polygon fill="#efebdd" stroke="transparent" points="94,-21 94,-41 140,-41 140,-21 94,-21"></polygon>
<text text-anchor="start" x="95.6192" y="-26.4" font-family="Times,serif" font-size="14.00" fill="#000000">airports</text>
<polygon fill="#ffffff" stroke="transparent" points="94,-1 94,-21 140,-21 140,-1 94,-1"></polygon>
<text text-anchor="start" x="96" y="-7.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">faa</text>
<polygon fill="none" stroke="#555555" points="93,0 93,-42 141,-42 141,0 93,0"></polygon>
</g>
<!-- flights -->
<g id="node3" class="node">
<title>flights</title>
<polygon fill="#efebdd" stroke="transparent" points="4,-101 4,-121 50,-121 50,-101 4,-101"></polygon>
<text text-anchor="start" x="9.1115" y="-106.4" font-family="Times,serif" font-size="14.00" fill="#000000">flights</text>
<polygon fill="#ffffff" stroke="transparent" points="4,-81 4,-101 50,-101 50,-81 4,-81"></polygon>
<text text-anchor="start" x="6" y="-86.4" font-family="Times,serif" font-size="14.00" fill="#444444">carrier</text>
<polygon fill="#ffffff" stroke="transparent" points="4,-61 4,-81 50,-81 50,-61 4,-61"></polygon>
<text text-anchor="start" x="5.6115" y="-66.4" font-family="Times,serif" font-size="14.00" fill="#444444">tailnum</text>
<polygon fill="#ffffff" stroke="transparent" points="4,-41 4,-61 50,-61 50,-41 4,-41"></polygon>
<text text-anchor="start" x="6" y="-46.4" font-family="Times,serif" font-size="14.00" fill="#444444">origin</text>
<polygon fill="none" stroke="#555555" points="3,-40 3,-122 51,-122 51,-40 3,-40"></polygon>
</g>
<!-- flights&#45;&gt;airlines -->
<g id="edge1" class="edge">
<title>flights:carrier-&gt;airlines:carrier</title>
<path fill="none" stroke="#555555" d="M50,-91C72.787,-91 69.9925,-120.0063 85.1849,-128.6176"></path>
<polygon fill="#555555" stroke="#555555" points="84.4566,-132.0424 95,-131 86.1078,-125.2399 84.4566,-132.0424"></polygon>
</g>
<!-- flights&#45;&gt;airports -->
<g id="edge2" class="edge">
<title>flights:origin-&gt;airports:faa</title>
<path fill="none" stroke="#555555" d="M50,-51C72.2991,-51 69.4778,-22.5234 83.9268,-13.6245"></path>
<polygon fill="#555555" stroke="#555555" points="85.2055,-16.9083 94,-11 83.4406,-10.1344 85.2055,-16.9083"></polygon>
</g>
<!-- planes -->
<g id="node4" class="node">
<title>planes</title>
<polygon fill="#efebdd" stroke="transparent" points="94,-81 94,-101 140,-101 140,-81 94,-81"></polygon>
<text text-anchor="start" x="99.1178" y="-86.4" font-family="Times,serif" font-size="14.00" fill="#000000">planes</text>
<polygon fill="#ffffff" stroke="transparent" points="94,-61 94,-81 140,-81 140,-61 94,-61"></polygon>
<text text-anchor="start" x="95.6115" y="-67.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">tailnum</text>
<polygon fill="none" stroke="#555555" points="93,-60 93,-102 141,-102 141,-60 93,-60"></polygon>
</g>
<!-- flights&#45;&gt;planes -->
<g id="edge3" class="edge">
<title>flights:tailnum-&gt;planes:tailnum</title>
<path fill="none" stroke="#555555" d="M50,-71C65.5833,-71 71.8532,-71 83.6529,-71"></path>
<polygon fill="#555555" stroke="#555555" points="84,-74.5001 94,-71 84,-67.5001 84,-74.5001"></polygon>
</g>
<!-- weather -->
<g id="node5" class="node">
<title>weather</title>
<polygon fill="#efebdd" stroke="transparent" points="3,-148 3,-168 51,-168 51,-148 3,-148"></polygon>
<text text-anchor="start" x="4.8492" y="-153.4" font-family="Times,serif" font-size="14.00" fill="#000000">weather</text>
<polygon fill="none" stroke="#555555" points="2,-147 2,-169 52,-169 52,-147 2,-147"></polygon>
</g>
</g>
</svg>

</div>
<div id="integrity-checks" class="section level2">
<h2>Integrity Checks</h2>
<p>As well as checking our data model visually, dm can examine the constraints we have created by the addition of keys and verify that they are sensible.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>flights_dm_no_keys <span class="op">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="st">  </span><span class="kw">dm_examine_constraints</span>()</span></code></pre></div>
<PRE class="fansi fansi-message"><CODE>#&gt; <span style="color: #00BBBB;">ℹ</span><span> No constraints defined.
</span></CODE></PRE>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a></span>
<span id="cb12-2"><a href="#cb12-2"></a>flights_dm_only_pks <span class="op">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="st">  </span><span class="kw">dm_examine_constraints</span>()</span></code></pre></div>
<PRE class="fansi fansi-message"><CODE>#&gt; <span style="color: #00BBBB;">ℹ</span><span> All constraints satisfied.
</span></CODE></PRE>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a></span>
<span id="cb13-2"><a href="#cb13-2"></a>flights_dm_all_keys <span class="op">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="st">  </span><span class="kw">dm_examine_constraints</span>()</span></code></pre></div>
<PRE class="fansi fansi-message"><CODE>#&gt; <span style="color: #BBBB00;">!</span><span> Unsatisfied constraints:
</span></CODE></PRE>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #BB0000;">●</span><span> Table `flights`: foreign key tailnum into table `planes`: 50094 entries (14.9%) of `flights$tailnum` not in `planes$tailnum`: N725MQ (575), N722MQ (513), N723MQ (507), N713MQ (483), N735MQ (396), …
</span></CODE></PRE>
<p>The results are presented in a human-readable form, and available as a tibble for programmatic inspection.</p>
</div>
<div id="programming" class="section level2">
<h2>Programming</h2>
<p>Helper functions are available to access details on keys and check results.</p>
<p><code>dm_get_all_pks()</code> returns a data frame with our primary keys:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>flights_dm_only_pks <span class="op">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="st">  </span><span class="kw">dm_get_all_pks</span>()</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #555555;"># A tibble: 3 x 2</span><span>
#&gt;   table    pk_col 
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;keys&gt;</span><span> 
#&gt; </span><span style="color: #555555;">1</span><span> airlines carrier
#&gt; </span><span style="color: #555555;">2</span><span> airports faa    
#&gt; </span><span style="color: #555555;">3</span><span> planes   tailnum
</span></CODE></PRE>
<p>A data frame of foreign keys is retrieved with <code>dm_get_all_fks()</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>flights_dm_all_keys <span class="op">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="st">  </span><span class="kw">dm_get_all_pks</span>()</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #555555;"># A tibble: 3 x 2</span><span>
#&gt;   table    pk_col 
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;keys&gt;</span><span> 
#&gt; </span><span style="color: #555555;">1</span><span> airlines carrier
#&gt; </span><span style="color: #555555;">2</span><span> airports faa    
#&gt; </span><span style="color: #555555;">3</span><span> planes   tailnum
</span></CODE></PRE>
<p>We can use <code>tibble::as_tibble()</code> on the result of <code>dm_examine_constraints()</code> to programmatically inspect which constraints are not satisfied:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>flights_dm_all_keys <span class="op">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="st">  </span><span class="kw">dm_examine_constraints</span>() <span class="op">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="st">  </span>tibble<span class="op">::</span><span class="kw">as_tibble</span>()</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #555555;"># A tibble: 6 x 6</span><span>
#&gt;   table   kind  columns ref_table is_key problem                           
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;keys&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>     </span><span style="color: #555555;font-style: italic;">&lt;lgl&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;chr&gt;</span><span>                             
#&gt; </span><span style="color: #555555;">1</span><span> flights FK    tailnum planes    FALSE  </span><span style="color: #555555;">&quot;</span><span>50094 entries (14.9%) of `flight…
#&gt; </span><span style="color: #555555;">2</span><span> airlin… PK    carrier </span><span style="color: #BB0000;">NA</span><span>        TRUE   </span><span style="color: #555555;">&quot;&quot;</span><span>                                
#&gt; </span><span style="color: #555555;">3</span><span> airpor… PK    faa     </span><span style="color: #BB0000;">NA</span><span>        TRUE   </span><span style="color: #555555;">&quot;&quot;</span><span>                                
#&gt; </span><span style="color: #555555;">4</span><span> planes  PK    tailnum </span><span style="color: #BB0000;">NA</span><span>        TRUE   </span><span style="color: #555555;">&quot;&quot;</span><span>                                
#&gt; </span><span style="color: #555555;">5</span><span> flights FK    carrier airlines  TRUE   </span><span style="color: #555555;">&quot;&quot;</span><span>                                
#&gt; </span><span style="color: #555555;">6</span><span> flights FK    origin  airports  TRUE   </span><span style="color: #555555;">&quot;&quot;</span><span>
</span></CODE></PRE>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
