<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Katharina Brunner" />

<meta name="date" content="2020-09-02" />

<title>Filtering in relational data models</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Filtering in relational data models</h1>
<h4 class="author">Katharina Brunner</h4>
<h4 class="date">2020-09-02</h4>



<p>The {dm} package offers functions to work with relational data models in R.</p>
<p>This document introduces you to filtering functions, and shows how to apply them to the data that is separated into multiple tables.</p>
<p>Our example data is drawn from the <a href="https://github.com/hadley/nycflights13">{nycflights13}</a> package that contains five inter-linked tables.</p>
<p>First, we will load the packages that we need:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(nycflights13)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(dm)</span></code></pre></div>
<div id="data-nycflights13" class="section level2">
<h2>Data: nycflights13</h2>
<p>To explore filtering with {dm}, we’ll use the {nycflights13} data with its <code>flights</code>, <code>planes</code>, <code>airlines</code>, <code>airports</code> and <code>weather</code> tables.</p>
<p>This dataset contains information about the 336 776 flights that departed from New York City in 2013, with 3322 different planes and 1458 airports involved. The data comes from the US Bureau of Transportation Statistics, and is documented in <code>?nycflights13::flights</code>.</p>
<p>To start with our exploration, we have to create a <code>dm</code> object from the {nycflights13} data. The built-in <code>dm::dm_nycflights13()</code> function takes care of this.</p>
<p>By default it only uses a subset of the complete data though: only the flights on the 10th of each month are considered, reducing the number of rows in the <code>flights</code> table to 11 227.</p>
<p>A <a href="https://krlmlr.github.io/dm/articles/tech-dm-class.html#class-dm">data model object</a> contains data from the source tables, and metadata about the tables.</p>
<p>If you would like to create a <code>dm</code> object from tables other than the example data, you can use the <code>new_dm()</code>, <code>dm()</code> or <code>as_dm()</code> functions. See <code>vignette(&quot;howto-dm-df&quot;)</code> for details.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>dm &lt;-<span class="st"> </span><span class="kw">dm_nycflights13</span>()</span></code></pre></div>
<p>The console output of the ’dm` object shows its data and metadata, and is colored for clarity:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>dm</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #FFAFFF;">──</span><span> </span><span style="color: #FFAFFF;">Metadata</span><span> </span><span style="color: #FFAFFF;">───────────────────────────────────────────────────────────────</span><span>
#&gt; Tables: `airlines`, `airports`, `flights`, `planes`, `weather`
#&gt; Columns: 53
#&gt; Primary keys: 3
#&gt; Foreign keys: 3
</span></CODE></PRE>
<p>Now we know that there are five tables in our <code>dm</code> object. But how are they connected? These relations are best displayed as a visualization of the entity-relationship model:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">dm_draw</span>(dm)</span></code></pre></div>
<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: %0 Pages: 1 -->
<svg width="152pt" height="200pt" viewBox="0.00 0.00 152.00 200.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 196)">
<title>%0</title>
<g id="a_graph0"><a xlink:title="Data Model">
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-196 148,-196 148,4 -4,4"></polygon>
</a>
</g>
<!-- airlines -->
<g id="node1" class="node">
<title>airlines</title>
<polygon fill="#ed7d31" stroke="transparent" points="95,-141 95,-161 140,-161 140,-141 95,-141"></polygon>
<text text-anchor="start" x="96.8969" y="-146.4" font-family="Times,serif" font-size="14.00" fill="#ffffff">airlines</text>
<polygon fill="#fbe5d5" stroke="transparent" points="95,-121 95,-141 140,-141 140,-121 95,-121"></polygon>
<text text-anchor="start" x="97" y="-127.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">carrier</text>
<polygon fill="none" stroke="#9e5320" stroke-opacity="0.666667" points="93.5,-120 93.5,-162 140.5,-162 140.5,-120 93.5,-120"></polygon>
</g>
<!-- airports -->
<g id="node2" class="node">
<title>airports</title>
<polygon fill="#ed7d31" stroke="transparent" points="94,-21 94,-41 140,-41 140,-21 94,-21"></polygon>
<text text-anchor="start" x="95.6192" y="-26.4" font-family="Times,serif" font-size="14.00" fill="#ffffff">airports</text>
<polygon fill="#fbe5d5" stroke="transparent" points="94,-1 94,-21 140,-21 140,-1 94,-1"></polygon>
<text text-anchor="start" x="96" y="-7.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">faa</text>
<polygon fill="none" stroke="#9e5320" stroke-opacity="0.666667" points="93,0 93,-42 141,-42 141,0 93,0"></polygon>
</g>
<!-- flights -->
<g id="node3" class="node">
<title>flights</title>
<polygon fill="#5b9bd5" stroke="transparent" points="4,-101 4,-121 50,-121 50,-101 4,-101"></polygon>
<text text-anchor="start" x="9.1115" y="-106.4" font-family="Times,serif" font-size="14.00" fill="#ffffff">flights</text>
<polygon fill="#deebf6" stroke="transparent" points="4,-81 4,-101 50,-101 50,-81 4,-81"></polygon>
<text text-anchor="start" x="6" y="-86.4" font-family="Times,serif" font-size="14.00" fill="#444444">carrier</text>
<polygon fill="#deebf6" stroke="transparent" points="4,-61 4,-81 50,-81 50,-61 4,-61"></polygon>
<text text-anchor="start" x="5.6115" y="-66.4" font-family="Times,serif" font-size="14.00" fill="#444444">tailnum</text>
<polygon fill="#deebf6" stroke="transparent" points="4,-41 4,-61 50,-61 50,-41 4,-41"></polygon>
<text text-anchor="start" x="6" y="-46.4" font-family="Times,serif" font-size="14.00" fill="#444444">origin</text>
<polygon fill="none" stroke="#3c678e" stroke-opacity="0.666667" points="3,-40 3,-122 51,-122 51,-40 3,-40"></polygon>
</g>
<!-- flights&#45;&gt;airlines -->
<g id="edge1" class="edge">
<title>flights:carrier-&gt;airlines:carrier</title>
<path fill="none" stroke="#555555" d="M50,-91C72.787,-91 69.9925,-120.0063 85.1849,-128.6176"></path>
<polygon fill="#555555" stroke="#555555" points="84.4566,-132.0424 95,-131 86.1078,-125.2399 84.4566,-132.0424"></polygon>
</g>
<!-- flights&#45;&gt;airports -->
<g id="edge2" class="edge">
<title>flights:origin-&gt;airports:faa</title>
<path fill="none" stroke="#555555" d="M50,-51C72.2991,-51 69.4778,-22.5234 83.9268,-13.6245"></path>
<polygon fill="#555555" stroke="#555555" points="85.2055,-16.9083 94,-11 83.4406,-10.1344 85.2055,-16.9083"></polygon>
</g>
<!-- planes -->
<g id="node4" class="node">
<title>planes</title>
<polygon fill="#ed7d31" stroke="transparent" points="94,-81 94,-101 140,-101 140,-81 94,-81"></polygon>
<text text-anchor="start" x="99.1178" y="-86.4" font-family="Times,serif" font-size="14.00" fill="#ffffff">planes</text>
<polygon fill="#fbe5d5" stroke="transparent" points="94,-61 94,-81 140,-81 140,-61 94,-61"></polygon>
<text text-anchor="start" x="95.6115" y="-67.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">tailnum</text>
<polygon fill="none" stroke="#9e5320" stroke-opacity="0.666667" points="93,-60 93,-102 141,-102 141,-60 93,-60"></polygon>
</g>
<!-- flights&#45;&gt;planes -->
<g id="edge3" class="edge">
<title>flights:tailnum-&gt;planes:tailnum</title>
<path fill="none" stroke="#555555" d="M50,-71C65.5833,-71 71.8532,-71 83.6529,-71"></path>
<polygon fill="#555555" stroke="#555555" points="84,-74.5001 94,-71 84,-67.5001 84,-74.5001"></polygon>
</g>
<!-- weather -->
<g id="node5" class="node">
<title>weather</title>
<polygon fill="#70ad47" stroke="transparent" points="15,-164 15,-184 63,-184 63,-164 15,-164"></polygon>
<text text-anchor="start" x="16.8492" y="-169.4" font-family="Times,serif" font-size="14.00" fill="#ffffff">weather</text>
<polygon fill="none" stroke="#4a732f" stroke-opacity="0.666667" points="14,-163 14,-185 64,-185 64,-163 14,-163"></polygon>
</g>
</g>
</svg>

<p>You can look at a single table with <code>tbl</code>. To print the <code>airports</code> table, call</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">tbl</span>(dm, <span class="st">&quot;airports&quot;</span>)</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #949494;"># A tibble: 1,458 x 8</span><span>
#&gt;    faa   name                    lat    lon   alt    tz dst   tzone        
#&gt;    </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>                 </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span>  </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>        
#&gt; </span><span style="color: #BCBCBC;"> 1</span><span> 04G   Lansdowne Airport      41.1  -</span><span style="color: #BB0000;">80.6</span><span>  </span><span style="text-decoration: underline;">1</span><span>044    -</span><span style="color: #BB0000;">5</span><span> A     America/New_…
#&gt; </span><span style="color: #BCBCBC;"> 2</span><span> 06A   Moton Field Municipa…  32.5  -</span><span style="color: #BB0000;">85.7</span><span>   264    -</span><span style="color: #BB0000;">6</span><span> A     America/Chic…
#&gt; </span><span style="color: #BCBCBC;"> 3</span><span> 06C   Schaumburg Regional    42.0  -</span><span style="color: #BB0000;">88.1</span><span>   801    -</span><span style="color: #BB0000;">6</span><span> A     America/Chic…
#&gt; </span><span style="color: #BCBCBC;"> 4</span><span> 06N   Randall Airport        41.4  -</span><span style="color: #BB0000;">74.4</span><span>   523    -</span><span style="color: #BB0000;">5</span><span> A     America/New_…
#&gt; </span><span style="color: #BCBCBC;"> 5</span><span> 09J   Jekyll Island Airport  31.1  -</span><span style="color: #BB0000;">81.4</span><span>    11    -</span><span style="color: #BB0000;">5</span><span> A     America/New_…
#&gt; </span><span style="color: #BCBCBC;"> 6</span><span> 0A9   Elizabethton Municip…  36.4  -</span><span style="color: #BB0000;">82.2</span><span>  </span><span style="text-decoration: underline;">1</span><span>593    -</span><span style="color: #BB0000;">5</span><span> A     America/New_…
#&gt; </span><span style="color: #BCBCBC;"> 7</span><span> 0G6   Williams County Airp…  41.5  -</span><span style="color: #BB0000;">84.5</span><span>   730    -</span><span style="color: #BB0000;">5</span><span> A     America/New_…
#&gt; </span><span style="color: #BCBCBC;"> 8</span><span> 0G7   Finger Lakes Regiona…  42.9  -</span><span style="color: #BB0000;">76.8</span><span>   492    -</span><span style="color: #BB0000;">5</span><span> A     America/New_…
#&gt; </span><span style="color: #BCBCBC;"> 9</span><span> 0P2   Shoestring Aviation …  39.8  -</span><span style="color: #BB0000;">76.6</span><span>  </span><span style="text-decoration: underline;">1</span><span>000    -</span><span style="color: #BB0000;">5</span><span> U     America/New_…
#&gt; </span><span style="color: #BCBCBC;">10</span><span> 0S9   Jefferson County Intl  48.1 -</span><span style="color: #BB0000;">123.</span><span>    108    -</span><span style="color: #BB0000;">8</span><span> A     America/Los_…
#&gt; </span><span style="color: #949494;"># … with 1,448 more rows</span><span>
</span></CODE></PRE>
</div>
<div id="filter" class="section level2">
<h2>Filtering a <code>dm</code> object</h2>
<p><code>dm_filter()</code> allows you to select a subset of a <code>dm</code> object.</p>
<div id="how-it-works" class="section level3">
<h3>How it works</h3>
<p>Filtering a <code>dm</code> object is not that different from filtering a dataframe or tibble with <code>dplyr::filter()</code>.</p>
<p>The corresponding {dm} function is <code>dm::dm_filter()</code>. With this function one or more filtering conditions can be set for one of the tables of the <code>dm</code> object. These conditions are immediately evaluated for their respective tables and in addition they are stored in the <code>dm</code>. There are two ways in which a condition on one table could affect another table:</p>
<ol style="list-style-type: decimal">
<li>Calling <code>dm_apply_filters_to_tbl()</code>, i.e. requesting a table from a <code>dm</code> after the filter conditions are applied. In this case, all tables that are connected to the requested table and have stored filter conditions associated with them are taken into account in the following way:
<ul>
<li>filtering semi-joins are successively performed along the paths from each of the filtered tables to the requested table, each join reducing the left-hand side tables of the joins to only those of their rows with key values that have corresponding values in key columns of the right-hand side tables of the join.</li>
<li>eventually the requested table is returned, containing only the the remaining rows after the filtering joins</li>
</ul></li>
<li>Calling <code>dm_apply_filters()</code> or <code>compute()</code> methods for <code>dm</code> objects on a <code>dm</code>: this results in a new <code>dm</code> that contains the same tables as before. Each table is the result of a <code>dm_apply_filters_to_tbl()</code> call, meaning that the effects of the filter conditions on each of the tables are taken into account.</li>
</ol>
<p>Currently, this only works if the graph induced by the foreign key relations is cycle free. Fortunately, this is the default for <code>dm_nycflights13()</code>.</p>
<p>Keep in mind that several {dm} functions will refuse to work when unevaluated filter conditions exist, such as, e.g. <code>dm_enum_fk_candidates()</code>, <code>dm_enum_pk_candidates()</code>, <code>dm_select_tbl()</code>, <code>dm_rename_tbl()</code>, <code>dm_select()</code>, <code>dm_rename()</code> and <code>dm_nrow()</code>. In these cases consider applying the filters with <code>dm_apply_filters()</code> first.</p>
</div>
<div id="filtering-examples" class="section level3">
<h3>Filtering Examples</h3>
<p>Let’s see filtering in action:</p>
<p><strong>We only want the data that is related to John F. Kennedy International Airport.</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>filtered_dm &lt;-<span class="st"> </span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="st">  </span>dm <span class="op">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="st">  </span><span class="kw">dm_filter</span>(airports, name <span class="op">==</span><span class="st"> &quot;John F Kennedy Intl&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a>filtered_dm</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #FFAFFF;">──</span><span> </span><span style="color: #FFAFFF;">Metadata</span><span> </span><span style="color: #FFAFFF;">───────────────────────────────────────────────────────────────</span><span>
#&gt; Tables: `airlines`, `airports`, `flights`, `planes`, `weather`
#&gt; Columns: 53
#&gt; Primary keys: 3
#&gt; Foreign keys: 3
#&gt; </span><span style="color: #FFAF00;">──</span><span> </span><span style="color: #FFAF00;">Filters</span><span> </span><span style="color: #FFAF00;">────────────────────────────────────────────────────────────────</span><span>
#&gt; airports: name == &quot;John F Kennedy Intl&quot;
</span></CODE></PRE>
<p>The filter expression is listed in the print output.</p>
<p>You can get the numbers of rows of each table with <code>dm_nrow()</code>. Before doing that, you will need to apply the filters using <code>dm_apply_filters()</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>rows_per_table &lt;-<span class="st"> </span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">  </span>filtered_dm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="st">  </span><span class="kw">dm_apply_filters</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st">  </span><span class="kw">dm_nrow</span>()</span>
<span id="cb7-5"><a href="#cb7-5"></a>rows_per_table</span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; airlines airports  flights   planes  weather </span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt;       10        1     3661      783      861</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="kw">sum</span>(rows_per_table)</span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt; [1] 5316</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>sum_nrow &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>sum_nrow_filtered &lt;-<span class="st"> </span><span class="ot">NA</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>sum_nrow &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dm_nrow</span>(dm))</span>
<span id="cb9-2"><a href="#cb9-2"></a>sum_nrow_filtered &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">dm_nrow</span>(<span class="kw">dm_apply_filters</span>(filtered_dm)))</span></code></pre></div>
<p>The total number of rows in the <code>dm</code> drops from 16 884 to 5 316 (the only unaffected table is the disconnected <code>weather</code> table).</p>
<p>Next example:</p>
<p><strong>Get a <code>dm</code> object containing data for flights from New York to the Dulles International Airport in Washington D.C., abbreviated with <code>IAD</code>.</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>dm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="st">  </span><span class="kw">dm_filter</span>(flights, dest <span class="op">==</span><span class="st"> &quot;IAD&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="st">  </span><span class="kw">dm_apply_filters</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="st">  </span><span class="kw">dm_nrow</span>()</span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">#&gt; airlines airports  flights   planes  weather </span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co">#&gt;        4        3      191       95      861</span></span></code></pre></div>
<p>Chaining multiple filters on different tables is also supported.</p>
<p>An example:</p>
<p><strong>Get all flights from Delta Air Lines which didn’t depart from John F. Kennedy International Airport in May 2013.</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>dm_delta_may &lt;-<span class="st"> </span>dm <span class="op">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="st">  </span><span class="kw">dm_filter</span>(airlines, name <span class="op">==</span><span class="st"> &quot;Delta Air Lines Inc.&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">  </span><span class="kw">dm_filter</span>(airports, name <span class="op">!=</span><span class="st"> &quot;John F Kennedy Intl&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">  </span><span class="kw">dm_filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">5</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a>dm_delta_may</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #FFAFFF;">──</span><span> </span><span style="color: #FFAFFF;">Metadata</span><span> </span><span style="color: #FFAFFF;">───────────────────────────────────────────────────────────────</span><span>
#&gt; Tables: `airlines`, `airports`, `flights`, `planes`, `weather`
#&gt; Columns: 53
#&gt; Primary keys: 3
#&gt; Foreign keys: 3
#&gt; </span><span style="color: #FFAF00;">──</span><span> </span><span style="color: #FFAF00;">Filters</span><span> </span><span style="color: #FFAF00;">────────────────────────────────────────────────────────────────</span><span>
#&gt; airlines: name == &quot;Delta Air Lines Inc.&quot;
#&gt; airports: name != &quot;John F Kennedy Intl&quot;
#&gt; flights: month == 5
</span></CODE></PRE>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>dm_delta_may <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="st">  </span><span class="kw">dm_apply_filters</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="st">  </span><span class="kw">dm_nrow</span>()</span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">#&gt; airlines airports  flights   planes  weather </span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co">#&gt;        1        2       79       61      861</span></span></code></pre></div>
<p>You can inspect the filtered tables with <code>dm_apply_filters_to_tbl()</code>.</p>
<p>In the <code>airlines</code> table, Delta is the only remaining carrier:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>dm_delta_may <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="st">  </span><span class="kw">dm_apply_filters_to_tbl</span>(<span class="st">&quot;airlines&quot;</span>)</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #949494;"># A tibble: 1 x 2</span><span>
#&gt;   carrier name                
#&gt;   </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>               
#&gt; </span><span style="color: #BCBCBC;">1</span><span> DL      Delta Air Lines Inc.
</span></CODE></PRE>
<p>Which planes were used to service these flights?</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>dm_delta_may <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="st">  </span><span class="kw">dm_apply_filters_to_tbl</span>(<span class="st">&quot;planes&quot;</span>)</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #949494;"># A tibble: 61 x 9</span><span>
#&gt;    tailnum  year type       manufacturer  model  engines seats speed engine
#&gt;    </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>   </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>      </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>         </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>    </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span> 
#&gt; </span><span style="color: #BCBCBC;"> 1</span><span> N305DQ   </span><span style="text-decoration: underline;">2</span><span>008 Fixed win… BOEING        737-7…       2   149    </span><span style="color: #BB0000;">NA</span><span> Turbo…
#&gt; </span><span style="color: #BCBCBC;"> 2</span><span> N310DE   </span><span style="text-decoration: underline;">2</span><span>009 Fixed win… BOEING        737-7…       2   149    </span><span style="color: #BB0000;">NA</span><span> Turbo…
#&gt; </span><span style="color: #BCBCBC;"> 3</span><span> N312US   </span><span style="text-decoration: underline;">1</span><span>990 Fixed win… AIRBUS INDUS… A320-…       2   182    </span><span style="color: #BB0000;">NA</span><span> Turbo…
#&gt; </span><span style="color: #BCBCBC;"> 4</span><span> N313US   </span><span style="text-decoration: underline;">1</span><span>990 Fixed win… AIRBUS INDUS… A320-…       2   182    </span><span style="color: #BB0000;">NA</span><span> Turbo…
#&gt; </span><span style="color: #BCBCBC;"> 5</span><span> N314US   </span><span style="text-decoration: underline;">1</span><span>991 Fixed win… AIRBUS INDUS… A320-…       2   182    </span><span style="color: #BB0000;">NA</span><span> Turbo…
#&gt; </span><span style="color: #BCBCBC;"> 6</span><span> N318NB   </span><span style="text-decoration: underline;">2</span><span>000 Fixed win… AIRBUS INDUS… A319-…       2   145    </span><span style="color: #BB0000;">NA</span><span> Turbo…
#&gt; </span><span style="color: #BCBCBC;"> 7</span><span> N322NB   </span><span style="text-decoration: underline;">2</span><span>001 Fixed win… AIRBUS INDUS… A319-…       2   145    </span><span style="color: #BB0000;">NA</span><span> Turbo…
#&gt; </span><span style="color: #BCBCBC;"> 8</span><span> N325NB   </span><span style="text-decoration: underline;">2</span><span>001 Fixed win… AIRBUS INDUS… A319-…       2   145    </span><span style="color: #BB0000;">NA</span><span> Turbo…
#&gt; </span><span style="color: #BCBCBC;"> 9</span><span> N329NW   </span><span style="text-decoration: underline;">1</span><span>992 Fixed win… AIRBUS INDUS… A320-…       2   182    </span><span style="color: #BB0000;">NA</span><span> Turbo…
#&gt; </span><span style="color: #BCBCBC;">10</span><span> N332NW   </span><span style="text-decoration: underline;">1</span><span>992 Fixed win… AIRBUS INDUS… A320-…       2   182    </span><span style="color: #BB0000;">NA</span><span> Turbo…
#&gt; </span><span style="color: #949494;"># … with 51 more rows</span><span>
</span></CODE></PRE>
<p>And indeed, all included flights departed in May (<code>month == 5</code>):</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>dm_delta_may <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="st">  </span><span class="kw">dm_apply_filters_to_tbl</span>(<span class="st">&quot;flights&quot;</span>)</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #949494;"># A tibble: 79 x 19</span><span>
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time
#&gt;    </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #BCBCBC;"> 1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5    10      554            600        -</span><span style="color: #BB0000;">6</span><span>      739
#&gt; </span><span style="color: #BCBCBC;"> 2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5    10      556            600        -</span><span style="color: #BB0000;">4</span><span>      825
#&gt; </span><span style="color: #BCBCBC;"> 3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5    10      606            610        -</span><span style="color: #BB0000;">4</span><span>      743
#&gt; </span><span style="color: #BCBCBC;"> 4</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5    10      625            630        -</span><span style="color: #BB0000;">5</span><span>      843
#&gt; </span><span style="color: #BCBCBC;"> 5</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5    10      653            700        -</span><span style="color: #BB0000;">7</span><span>      923
#&gt; </span><span style="color: #BCBCBC;"> 6</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5    10      656            700        -</span><span style="color: #BB0000;">4</span><span>      911
#&gt; </span><span style="color: #BCBCBC;"> 7</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5    10      700            700         0      958
#&gt; </span><span style="color: #BCBCBC;"> 8</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5    10      701            705        -</span><span style="color: #BB0000;">4</span><span>      952
#&gt; </span><span style="color: #BCBCBC;"> 9</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5    10      714            715        -</span><span style="color: #BB0000;">1</span><span>      908
#&gt; </span><span style="color: #BCBCBC;">10</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5    10      743            745        -</span><span style="color: #BB0000;">2</span><span>      956
#&gt; </span><span style="color: #949494;"># … with 69 more rows, and 12 more variables: sched_arr_time </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span style="color: #949494;">,</span><span>
#&gt; </span><span style="color: #949494;">#   arr_delay </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span style="color: #949494;">, carrier </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span style="color: #949494;">, flight </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span style="color: #949494;">, tailnum </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span style="color: #949494;">,</span><span>
#&gt; </span><span style="color: #949494;">#   origin </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span style="color: #949494;">, dest </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span style="color: #949494;">, air_time </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span style="color: #949494;">, distance </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span style="color: #949494;">, hour </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span style="color: #949494;">,</span><span>
#&gt; </span><span style="color: #949494;">#   minute </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span style="color: #949494;">, time_hour </span><span style="color: #949494;font-style: italic;">&lt;dttm&gt;</span><span>
</span></CODE></PRE>
<p>For comparison, let’s review the equivalent manual query for <code>flights</code> in <code>dplyr</code> syntax:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>airlines_filtered &lt;-<span class="st"> </span><span class="kw">filter</span>(airlines, name <span class="op">==</span><span class="st"> &quot;Delta Air Lines Inc.&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2"></a>airports_filtered &lt;-<span class="st"> </span><span class="kw">filter</span>(airports, name <span class="op">!=</span><span class="st"> &quot;John F Kennedy Intl&quot;</span>)</span>
<span id="cb16-3"><a href="#cb16-3"></a>flights <span class="op">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="st">  </span><span class="kw">semi_join</span>(airlines_filtered, <span class="dt">by =</span> <span class="st">&quot;carrier&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="st">  </span><span class="kw">semi_join</span>(airports_filtered, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span> =<span class="st"> &quot;faa&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="st">  </span><span class="kw">filter</span>(month <span class="op">==</span><span class="st"> </span><span class="dv">5</span>)</span></code></pre></div>
<PRE class="fansi fansi-output"><CODE>#&gt; <span style="color: #949494;"># A tibble: 2,340 x 19</span><span>
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time
#&gt;    </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span>     </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #BCBCBC;"> 1</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5     1      554            600        -</span><span style="color: #BB0000;">6</span><span>      731
#&gt; </span><span style="color: #BCBCBC;"> 2</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5     1      555            600        -</span><span style="color: #BB0000;">5</span><span>      819
#&gt; </span><span style="color: #BCBCBC;"> 3</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5     1      603            610        -</span><span style="color: #BB0000;">7</span><span>      754
#&gt; </span><span style="color: #BCBCBC;"> 4</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5     1      622            630        -</span><span style="color: #BB0000;">8</span><span>      848
#&gt; </span><span style="color: #BCBCBC;"> 5</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5     1      654            700        -</span><span style="color: #BB0000;">6</span><span>      931
#&gt; </span><span style="color: #BCBCBC;"> 6</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5     1      655            700        -</span><span style="color: #BB0000;">5</span><span>      944
#&gt; </span><span style="color: #BCBCBC;"> 7</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5     1      656            705        -</span><span style="color: #BB0000;">9</span><span>     </span><span style="text-decoration: underline;">1</span><span>005
#&gt; </span><span style="color: #BCBCBC;"> 8</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5     1      658            700        -</span><span style="color: #BB0000;">2</span><span>      925
#&gt; </span><span style="color: #BCBCBC;"> 9</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5     1      743            745        -</span><span style="color: #BB0000;">2</span><span>     </span><span style="text-decoration: underline;">1</span><span>014
#&gt; </span><span style="color: #BCBCBC;">10</span><span>  </span><span style="text-decoration: underline;">2</span><span>013     5     1      755            800        -</span><span style="color: #BB0000;">5</span><span>      929
#&gt; </span><span style="color: #949494;"># … with 2,330 more rows, and 12 more variables: sched_arr_time </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span style="color: #949494;">,</span><span>
#&gt; </span><span style="color: #949494;">#   arr_delay </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span style="color: #949494;">, carrier </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span style="color: #949494;">, flight </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span style="color: #949494;">, tailnum </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span style="color: #949494;">,</span><span>
#&gt; </span><span style="color: #949494;">#   origin </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span style="color: #949494;">, dest </span><span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span style="color: #949494;">, air_time </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span style="color: #949494;">, distance </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span style="color: #949494;">, hour </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span style="color: #949494;">,</span><span>
#&gt; </span><span style="color: #949494;">#   minute </span><span style="color: #949494;font-style: italic;">&lt;dbl&gt;</span><span style="color: #949494;">, time_hour </span><span style="color: #949494;font-style: italic;">&lt;dttm&gt;</span><span>
</span></CODE></PRE>
<p>The {dm} code is leaner because the foreign key information is encoded in the object.</p>
</div>
</div>
<div id="sql-statements-behind-filtering-a-dm-object-on-a-database" class="section level2">
<h2>SQL statements behind filtering a <code>dm</code> object on a database</h2>
<p>{dm} is meant to work with relational data models, locally as well as on databases. In your project, the data is probably not stored locally but in a remote <a href="https://krlmlr.github.io/dm/articles/howto-dm-theory.html#relational-databases">relational database</a> that can be queried with SQL statements.</p>
<p>You can check the queries by using <code>sql_render()</code> from the <a href="https://dbplyr.tidyverse.org/">{dbplyr}</a> package.</p>
<p>Example:</p>
<p><strong>Print the SQL statements for getting all flights from Delta Air Lines, which did not depart from John F. Kennedy International Airport in May 2013, with the data stored in a sqlite database.</strong></p>
<p>To show the SQL query behind a <code>dm_filter()</code>, we copy the <code>flights</code>, <code>airlines</code> and <code>airports</code> tables from the <code>nyflights13</code> dataset to a temporary in-memory database using the built-in function <code>copy_dm_to()</code> and <code>dbplyr::src_memdb</code>.</p>
<p>Then we filter the data, and print the corresponding SQL statement with <code>dbplyr::sql_render()</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>dm <span class="op">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="st">  </span><span class="kw">dm_select_tbl</span>(flights, airlines, airports) <span class="op">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="st">  </span><span class="kw">dm_filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="st">  </span><span class="kw">copy_dm_to</span>(dbplyr<span class="op">::</span><span class="kw">src_memdb</span>(), .) <span class="op">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="st">  </span><span class="kw">dm_filter</span>(airlines, name <span class="op">==</span><span class="st"> &quot;Delta Air Lines Inc.&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="st">  </span><span class="kw">dm_filter</span>(airports, name <span class="op">!=</span><span class="st"> &quot;John F Kennedy Intl&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="st">  </span><span class="kw">dm_apply_filters</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="st">  </span><span class="kw">dm_get_tables</span>() <span class="op">%&gt;%</span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="st">  </span><span class="kw">map</span>(dbplyr<span class="op">::</span>sql_render)</span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="co">#&gt; $flights</span></span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="co">#&gt; &lt;SQL&gt; SELECT * FROM (SELECT * FROM `flights_2020_09_02_04_53_10_3` AS `LHS`</span></span>
<span id="cb17-12"><a href="#cb17-12"></a><span class="co">#&gt; WHERE EXISTS (</span></span>
<span id="cb17-13"><a href="#cb17-13"></a><span class="co">#&gt;   SELECT 1 FROM (SELECT *</span></span>
<span id="cb17-14"><a href="#cb17-14"></a><span class="co">#&gt; FROM `airlines_2020_09_02_04_53_10_3`</span></span>
<span id="cb17-15"><a href="#cb17-15"></a><span class="co">#&gt; WHERE (`name` = &#39;Delta Air Lines Inc.&#39;)) AS `RHS`</span></span>
<span id="cb17-16"><a href="#cb17-16"></a><span class="co">#&gt;   WHERE (`LHS`.`carrier` = `RHS`.`carrier`)</span></span>
<span id="cb17-17"><a href="#cb17-17"></a><span class="co">#&gt; )) AS `LHS`</span></span>
<span id="cb17-18"><a href="#cb17-18"></a><span class="co">#&gt; WHERE EXISTS (</span></span>
<span id="cb17-19"><a href="#cb17-19"></a><span class="co">#&gt;   SELECT 1 FROM (SELECT *</span></span>
<span id="cb17-20"><a href="#cb17-20"></a><span class="co">#&gt; FROM `airports_2020_09_02_04_53_10_3`</span></span>
<span id="cb17-21"><a href="#cb17-21"></a><span class="co">#&gt; WHERE (`name` != &#39;John F Kennedy Intl&#39;)) AS `RHS`</span></span>
<span id="cb17-22"><a href="#cb17-22"></a><span class="co">#&gt;   WHERE (`LHS`.`origin` = `RHS`.`faa`)</span></span>
<span id="cb17-23"><a href="#cb17-23"></a><span class="co">#&gt; )</span></span>
<span id="cb17-24"><a href="#cb17-24"></a><span class="co">#&gt; </span></span>
<span id="cb17-25"><a href="#cb17-25"></a><span class="co">#&gt; $airlines</span></span>
<span id="cb17-26"><a href="#cb17-26"></a><span class="co">#&gt; &lt;SQL&gt; SELECT * FROM (SELECT *</span></span>
<span id="cb17-27"><a href="#cb17-27"></a><span class="co">#&gt; FROM `airlines_2020_09_02_04_53_10_3`</span></span>
<span id="cb17-28"><a href="#cb17-28"></a><span class="co">#&gt; WHERE (`name` = &#39;Delta Air Lines Inc.&#39;)) AS `LHS`</span></span>
<span id="cb17-29"><a href="#cb17-29"></a><span class="co">#&gt; WHERE EXISTS (</span></span>
<span id="cb17-30"><a href="#cb17-30"></a><span class="co">#&gt;   SELECT 1 FROM (SELECT * FROM `flights_2020_09_02_04_53_10_3` AS `LHS`</span></span>
<span id="cb17-31"><a href="#cb17-31"></a><span class="co">#&gt; WHERE EXISTS (</span></span>
<span id="cb17-32"><a href="#cb17-32"></a><span class="co">#&gt;   SELECT 1 FROM (SELECT *</span></span>
<span id="cb17-33"><a href="#cb17-33"></a><span class="co">#&gt; FROM `airports_2020_09_02_04_53_10_3`</span></span>
<span id="cb17-34"><a href="#cb17-34"></a><span class="co">#&gt; WHERE (`name` != &#39;John F Kennedy Intl&#39;)) AS `RHS`</span></span>
<span id="cb17-35"><a href="#cb17-35"></a><span class="co">#&gt;   WHERE (`LHS`.`origin` = `RHS`.`faa`)</span></span>
<span id="cb17-36"><a href="#cb17-36"></a><span class="co">#&gt; )) AS `RHS`</span></span>
<span id="cb17-37"><a href="#cb17-37"></a><span class="co">#&gt;   WHERE (`LHS`.`carrier` = `RHS`.`carrier`)</span></span>
<span id="cb17-38"><a href="#cb17-38"></a><span class="co">#&gt; )</span></span>
<span id="cb17-39"><a href="#cb17-39"></a><span class="co">#&gt; </span></span>
<span id="cb17-40"><a href="#cb17-40"></a><span class="co">#&gt; $airports</span></span>
<span id="cb17-41"><a href="#cb17-41"></a><span class="co">#&gt; &lt;SQL&gt; SELECT * FROM (SELECT *</span></span>
<span id="cb17-42"><a href="#cb17-42"></a><span class="co">#&gt; FROM `airports_2020_09_02_04_53_10_3`</span></span>
<span id="cb17-43"><a href="#cb17-43"></a><span class="co">#&gt; WHERE (`name` != &#39;John F Kennedy Intl&#39;)) AS `LHS`</span></span>
<span id="cb17-44"><a href="#cb17-44"></a><span class="co">#&gt; WHERE EXISTS (</span></span>
<span id="cb17-45"><a href="#cb17-45"></a><span class="co">#&gt;   SELECT 1 FROM (SELECT * FROM `flights_2020_09_02_04_53_10_3` AS `LHS`</span></span>
<span id="cb17-46"><a href="#cb17-46"></a><span class="co">#&gt; WHERE EXISTS (</span></span>
<span id="cb17-47"><a href="#cb17-47"></a><span class="co">#&gt;   SELECT 1 FROM (SELECT *</span></span>
<span id="cb17-48"><a href="#cb17-48"></a><span class="co">#&gt; FROM `airlines_2020_09_02_04_53_10_3`</span></span>
<span id="cb17-49"><a href="#cb17-49"></a><span class="co">#&gt; WHERE (`name` = &#39;Delta Air Lines Inc.&#39;)) AS `RHS`</span></span>
<span id="cb17-50"><a href="#cb17-50"></a><span class="co">#&gt;   WHERE (`LHS`.`carrier` = `RHS`.`carrier`)</span></span>
<span id="cb17-51"><a href="#cb17-51"></a><span class="co">#&gt; )) AS `RHS`</span></span>
<span id="cb17-52"><a href="#cb17-52"></a><span class="co">#&gt;   WHERE (`LHS`.`faa` = `RHS`.`origin`)</span></span>
<span id="cb17-53"><a href="#cb17-53"></a><span class="co">#&gt; )</span></span></code></pre></div>
<p>Further reading: {dm}’s function for copying data <a href="https://krlmlr.github.io/dm/articles/dm.html#copy">from and to databases</a>.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
